---

name: CI

on:
  pull_request:
  push:

defaults:
  run:
    working-directory: "<= github.owner =>/<= github.repo =>"

jobs:

  lint:
    name: Lint
    runs-on: [ 'self-hosted', 'linux', 'X64' ]
    steps:
      - name: Check out the codebase.
        uses: actions/checkout@v3
        with:
          path: "${{ github.repository }}"

      - name: Set-up virtualenv w/ test dependencies
        run: |
          virtualenv /tmp/venv
          source /tmp/venv/bin/activate
          pip3 install ansible ansible-lint==5.4.0 yamllint jmespath

      - name: Lint code.
        run: |
          set -e
          source /tmp/venv/bin/activate
          yamllint .
          ansible-lint
